<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>3: Branch Switching Using Normal Forms · juliajim</title><meta name="title" content="3: Branch Switching Using Normal Forms · juliajim"/><meta property="og:title" content="3: Branch Switching Using Normal Forms · juliajim"/><meta property="twitter:title" content="3: Branch Switching Using Normal Forms · juliajim"/><meta name="description" content="Documentation for juliajim."/><meta property="og:description" content="Documentation for juliajim."/><meta property="twitter:description" content="Documentation for juliajim."/><meta property="og:url" content="https://github.com/Nidish96/juliajim/d3_normalform/"/><meta property="twitter:url" content="https://github.com/Nidish96/juliajim/d3_normalform/"/><link rel="canonical" href="https://github.com/Nidish96/juliajim/d3_normalform/"/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../assets/custom.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">juliajim</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../a_hworld/">A: Harmonic Utilities</a></li><li><input class="collapse-toggle" id="menuitem-2-2" type="checkbox"/><label class="tocitem" for="menuitem-2-2"><span class="docs-label">B: Numerical Continuation</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../b1_duffhb/">1: Duffing Oscillator</a></li><li><a class="tocitem" href="../b2_jenkhb/">2: Frictional Oscillator</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-3" type="checkbox"/><label class="tocitem" for="menuitem-2-3"><span class="docs-label">C: Examples with the MDOFUTILS Suite</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../c1_mdofgen_instnl/">1: Forced Response of a 2DoF Oscillator with Instantaneous Nonlinearity</a></li><li><a class="tocitem" href="../c2_mdofgen_hystnl/">2: Forced Response of a 2DoF Oscillator with Hysteretic Nonlinearity</a></li><li><a class="tocitem" href="../c3_mdofgen_ahb/">3: Response Constrained Forced Response of a 2DoF Hysteretic Oscillator</a></li><li><a class="tocitem" href="../c4_mdofgen_epmc/">4: Nonlinear Normal Modes of a 2DoF Hysteretic Oscillator using EPMC</a></li><li><a class="tocitem" href="../c5_mdofgen_newmark/">5: Transient Response of a 2DoF Hysteretic Oscillator using Newmark Scheme</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-4" type="checkbox" checked/><label class="tocitem" for="menuitem-2-4"><span class="docs-label">D: Bifurcation Analysis Examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../d1_deflation/">1: Deflation to Locate Multiple roots</a></li><li><a class="tocitem" href="../d2_forcedvdp/">2: Bifurcation Analysis of the Forced Response of a Van der Pol Oscillator</a></li><li class="is-active"><a class="tocitem" href>3: Branch Switching Using Normal Forms</a><ul class="internal"><li><a class="tocitem" href="#ex_d3"><span>Example D3: Branch Switching Using Normal Forms</span></a></li><li><a class="tocitem" href="#Preamble:-Load-Packages"><span>Preamble: Load Packages</span></a></li><li><a class="tocitem" href="#System-Setup"><span>System Setup</span></a></li><li><a class="tocitem" href="#Setup-HB"><span>Setup HB</span></a></li><li><a class="tocitem" href="#Setup-HB-Residue,-Get-First-Point"><span>Setup HB Residue, Get First Point</span></a></li><li><a class="tocitem" href="#Continuation"><span>Continuation</span></a></li><li><a class="tocitem" href="#Bifurcation-Analysis"><span>Bifurcation Analysis</span></a></li></ul></li></ul></li><li><a class="tocitem" href="../e_febeam/">E: Finite Element Beam with Nonlinear Support</a></li><li><a class="tocitem" href="../reference/">Reference</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li><a class="is-disabled">D: Bifurcation Analysis Examples</a></li><li class="is-active"><a href>3: Branch Switching Using Normal Forms</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>3: Branch Switching Using Normal Forms</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/Nidish96/juliajim/blob/master/examples/d3_normalform.jl#" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h2 id="ex_d3"><a class="docs-heading-anchor" href="#ex_d3">Example D3: Branch Switching Using Normal Forms</a><a id="ex_d3-1"></a><a class="docs-heading-anchor-permalink" href="#ex_d3" title="Permalink"></a></h2><p>This example is a direct continuation of <a href="../d2_forcedvdp/#ex_d2">Example D2</a>. In that example we did a branch switching analysis by arbitrarily choosing the amplitude of perturbation. Here, we use the <a href="../reference/#juliajim.NLDYN.NORMALFORMFIT-Tuple{Any, Any, Any}"><code>NORMALFORMFIT</code></a> function to fit the system to a cubic nonlinear &quot;normal form&quot; (through a similarity transformation eliminating certain terms).</p><p>The normal form can easily be interpreted to provide an estimate for the bifurcated branch amplitudes. It can be seen that the normal form approach provides a near exact estimate of the bifurcated branch amplitude in the end of this example.</p><h2 id="Preamble:-Load-Packages"><a class="docs-heading-anchor" href="#Preamble:-Load-Packages">Preamble: Load Packages</a><a id="Preamble:-Load-Packages-1"></a><a class="docs-heading-anchor-permalink" href="#Preamble:-Load-Packages" title="Permalink"></a></h2><p>using GLMakie</p><pre><code class="language-julia hljs">using LinearAlgebra
using SparseArrays
using NonlinearSolve
using DSP

using Revise
using juliajim.HARMONIC
using juliajim.CONTINUATION
using juliajim.MDOFUTILS
using juliajim.NLDYN</code></pre><h2 id="System-Setup"><a class="docs-heading-anchor" href="#System-Setup">System Setup</a><a id="System-Setup-1"></a><a class="docs-heading-anchor-permalink" href="#System-Setup" title="Permalink"></a></h2><p>Here we setup the system with parameters.</p><pre><code class="language-julia hljs">pars = (c=0.02, k=4., F=1., eta=0.1);

mdl = MDOFGEN(1.0, -pars.c, pars.k);
fnl = (t,u,ud) -&gt; return pars.eta.*u.^2 .*ud, 2pars.eta.*u.*ud, pars.eta.*u.^2;
mdl = ADDNL(mdl, :Inst, fnl, 1.0);</code></pre><h2 id="Setup-HB"><a class="docs-heading-anchor" href="#Setup-HB">Setup HB</a><a id="Setup-HB-1"></a><a class="docs-heading-anchor-permalink" href="#Setup-HB" title="Permalink"></a></h2><pre><code class="language-julia hljs">h = 0:5;
N = 128;
t = range(0, 2π, N+1)[1:N];

Nhc = NHC(h);

inds0, hinds, zinds, rinds, iinds = HINDS(mdl.Ndofs, h);
Fl = zeros(Nhc*mdl.Ndofs, 1);
Fl[rinds[1]] = pars.F;

Om0 = 0.1;
Om1 = 2.0;
E, dEdw = HARMONICSTIFFNESS(mdl.M, mdl.C, mdl.K, Om0, h);

Uw0 = [E\Fl; Om0];</code></pre><h2 id="Setup-HB-Residue,-Get-First-Point"><a class="docs-heading-anchor" href="#Setup-HB-Residue,-Get-First-Point">Setup HB Residue, Get First Point</a><a id="Setup-HB-Residue,-Get-First-Point-1"></a><a class="docs-heading-anchor-permalink" href="#Setup-HB-Residue,-Get-First-Point" title="Permalink"></a></h2><pre><code class="language-julia hljs">fun = NonlinearFunction((r,u,p)-&gt;HBRESFUN!([u;p], mdl, Fl, h, N; R=r),
    jac=(J,u,p)-&gt;HBRESFUN!([u;p], mdl, Fl, h, N; dRdU=J),
    paramjac=(Jp,u,p)-&gt;HBRESFUN!([u;p], mdl, Fl, h, N; dRdw=Jp));

prob = NonlinearProblem(fun, Uw0[1:end-1], Uw0[end]);
sol = solve(prob, show_trace=Val(true));</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">
Algorithm: NewtonRaphson(
    descent = NewtonDescent(),
    autodiff = AutoForwardDiff(),
    vjp_autodiff = AutoFiniteDiff(
        fdtype = Val{:forward}(),
        fdjtype = Val{:forward}(),
        fdhtype = Val{:hcentral}(),
        dir = true
    ),
    jvp_autodiff = AutoForwardDiff(),
    concrete_jac = Val{false}()
)

----    	-------------       	-----------
Iter    	f(u) inf-norm       	Step 2-norm
----    	-------------       	-----------
0       	3.93569199e-05      	0.00000000e+00
1       	9.39503268e-13      	1.40930725e-05
2       	1.11022302e-16      	2.66616371e-13
Final   	1.11022302e-16
----------------------</code></pre><h2 id="Continuation"><a class="docs-heading-anchor" href="#Continuation">Continuation</a><a id="Continuation-1"></a><a class="docs-heading-anchor-permalink" href="#Continuation" title="Permalink"></a></h2><pre><code class="language-julia hljs">Om0 = 0.1;
Om1 = 4.0;
dOm = 0.1;
cpars = (parm=:arclength, nmax=200, save_jacs=true);

sols, _, _, _, _ = CONTINUATE(Uw0[1:end-1], fun, [Om0, Om1], dOm; cpars...);</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">
Algorithm: NewtonRaphson(
    descent = NewtonDescent(),
    autodiff = AutoForwardDiff(),
    vjp_autodiff = AutoFiniteDiff(
        fdtype = Val{:forward}(),
        fdjtype = Val{:forward}(),
        fdhtype = Val{:hcentral}(),
        dir = true
    ),
    jvp_autodiff = AutoForwardDiff(),
    concrete_jac = Val{false}()
)

----    	-------------       	-----------
Iter    	f(u) inf-norm       	Step 2-norm
----    	-------------       	-----------
0       	3.93569199e-05      	1.41421356e-06
1       	9.39503268e-13      	1.40930725e-05
Final   	9.39503268e-13
----------------------
2. 0.20 with step 0.0995 (0.9973) converged in 1 iterations. 0.198243 Δα.
3. 0.32 with step 0.1166 (0.8295) converged in 1 iterations. 0.149248 Δα.
4. 0.47 with step 0.1534 (0.7319) converged in 2 iterations. 0.144244 Δα.
5. 0.62 with step 0.1675 (0.5434) converged in 3 iterations. 0.148937 Δα.
6. 0.65 with step 0.0656 (0.3648) converged in 3 iterations. 1.703467 Δα.
7. 0.66 with step 0.0061 (0.1995) converged in 2 iterations. 1.053112 Δα.
8. 0.66 with step 0.0034 (0.1995) converged in 1 iterations. 0.824959 Δα.
9. 0.66 with step 0.0021 (0.1995) converged in 1 iterations. 0.622041 Δα.
10. 0.66 with step 0.0014 (0.1995) converged in 1 iterations. 0.500999 Δα.
11. 0.66 with step 0.0010 (0.1995) converged in 1 iterations. 0.415927 Δα.
12. 0.66 with step 0.0008 (0.1995) converged in 1 iterations. 0.372828 Δα.
13. 0.66 with step 0.0006 (0.1995) converged in 1 iterations. 0.411008 Δα.
14. 0.66 with step 0.0005 (0.1995) converged in 1 iterations. 0.799945 Δα.
15. 0.66 with step 0.0005 (0.1995) converged in 1 iterations. 4.148018 Δα.
16. 0.66 with step 0.0005 (0.1995) converged in 1 iterations. 1.617876 Δα.
17. 0.67 with step 0.0005 (0.1995) converged in 1 iterations. 0.820404 Δα.
18. 0.67 with step 0.0004 (0.1995) converged in 1 iterations. 0.493481 Δα.
19. 0.67 with step 0.0003 (0.1995) converged in 1 iterations. 0.360587 Δα.
20. 0.67 with step 0.0003 (0.1995) converged in 1 iterations. 0.322538 Δα.
21. 0.67 with step 0.0002 (0.1995) converged in 1 iterations. 0.389985 Δα.
22. 0.67 with step 0.0002 (0.1995) converged in 1 iterations. 0.583433 Δα.
23. 0.67 with step 0.0002 (0.1995) converged in 1 iterations. 1.128016 Δα.
24. 0.67 with step 0.0002 (0.1995) converged in 1 iterations. 5.061418 Δα.
25. 0.67 with step 0.0002 (0.1995) converged in 1 iterations. 0.895962 Δα.
26. 0.67 with step 0.0002 (0.1995) converged in 1 iterations. 0.511306 Δα.
27. 0.67 with step 0.0002 (0.1995) converged in 1 iterations. 0.371109 Δα.
28. 0.67 with step 0.0003 (0.1995) converged in 1 iterations. 0.340934 Δα.
29. 0.67 with step 0.0003 (0.1995) converged in 1 iterations. 0.361214 Δα.
30. 0.67 with step 0.0004 (0.1995) converged in 1 iterations. 0.597956 Δα.
31. 0.67 with step 0.0006 (0.1995) converged in 1 iterations. 1.429144 Δα.
32. 0.67 with step 0.0006 (0.1995) converged in 1 iterations. 2.885099 Δα.
33. 0.67 with step 0.0007 (0.1995) converged in 1 iterations. 0.491122 Δα.
34. 0.67 with step 0.0007 (0.1995) converged in 1 iterations. 0.342260 Δα.
35. 0.67 with step 0.0010 (0.1995) converged in 1 iterations. 0.417787 Δα.
36. 0.67 with step 0.0014 (0.1995) converged in 1 iterations. 0.540720 Δα.
37. 0.68 with step 0.0021 (0.1995) converged in 1 iterations. 0.713325 Δα.
38. 0.68 with step 0.0035 (0.1995) converged in 2 iterations. 0.994537 Δα.
39. 0.70 with step 0.0073 (0.1995) converged in 2 iterations. 1.533283 Δα.
40. 0.76 with step 0.0237 (0.1995) converged in 4 iterations. 2.485195 Δα.
41. 0.89 with step 0.1171 (0.1995) converged in 3 iterations. 1.555734 Δα.
42. 1.01 with step 0.1313 (0.1995) converged in 2 iterations. 0.330698 Δα.
43. 1.13 with step 0.1299 (0.1995) converged in 2 iterations. 0.344494 Δα.
44. 1.24 with step 0.1214 (0.1995) converged in 2 iterations. 0.339300 Δα.
45. 1.34 with step 0.1089 (0.1995) converged in 2 iterations. 0.318374 Δα.
46. 1.43 with step 0.0965 (0.1995) converged in 2 iterations. 0.301264 Δα.
47. 1.51 with step 0.0873 (0.1995) converged in 2 iterations. 0.644432 Δα.
48. 1.59 with step 0.0837 (0.1995) converged in 3 iterations. 1.617097 Δα.
49. 1.64 with step 0.0766 (0.1995) converged in 3 iterations. 3.188053 Δα.
50. 1.67 with step 0.0395 (0.1995) converged in 3 iterations. 0.768936 Δα.
51. 1.69 with step 0.0234 (0.1995) converged in 2 iterations. 0.434956 Δα.
52. 1.70 with step 0.0163 (0.1995) converged in 2 iterations. 0.307265 Δα.
53. 1.71 with step 0.0125 (0.1995) converged in 2 iterations. 0.238993 Δα.
54. 1.72 with step 0.0101 (0.1995) converged in 2 iterations. 0.196130 Δα.
55. 1.73 with step 0.0084 (0.1995) converged in 2 iterations. 0.166580 Δα.
56. 1.74 with step 0.0072 (0.1995) converged in 2 iterations. 0.144924 Δα.
57. 1.74 with step 0.0063 (0.1995) converged in 2 iterations. 0.128349 Δα.
58. 1.75 with step 0.0055 (0.1995) converged in 2 iterations. 0.115242 Δα.
59. 1.75 with step 0.0054 (0.1995) converged in 2 iterations. 0.112831 Δα.
60. 1.76 with step 0.0054 (0.1995) converged in 2 iterations. 0.154956 Δα.
61. 1.76 with step 0.0055 (0.1995) converged in 2 iterations. 0.159010 Δα.
62. 1.77 with step 0.0057 (0.1995) converged in 2 iterations. 0.163820 Δα.
63. 1.77 with step 0.0058 (0.1995) converged in 2 iterations. 0.168741 Δα.
64. 1.78 with step 0.0059 (0.1995) converged in 2 iterations. 0.173486 Δα.
65. 1.79 with step 0.0060 (0.1995) converged in 2 iterations. 0.177934 Δα.
66. 1.79 with step 0.0061 (0.1995) converged in 2 iterations. 0.182033 Δα.
67. 1.80 with step 0.0061 (0.1995) converged in 2 iterations. 0.185767 Δα.
68. 1.80 with step 0.0061 (0.1995) converged in 2 iterations. 0.189143 Δα.
69. 1.81 with step 0.0061 (0.1995) converged in 2 iterations. 0.192178 Δα.
70. 1.81 with step 0.0061 (0.1995) converged in 2 iterations. 0.194916 Δα.
71. 1.82 with step 0.0061 (0.1995) converged in 2 iterations. 0.197435 Δα.
72. 1.83 with step 0.0061 (0.1995) converged in 2 iterations. 0.199889 Δα.
73. 1.83 with step 0.0060 (0.1995) converged in 2 iterations. 0.202576 Δα.
74. 1.84 with step 0.0060 (0.1995) converged in 2 iterations. 0.206091 Δα.
75. 1.84 with step 0.0059 (0.1995) converged in 2 iterations. 0.211650 Δα.
76. 1.85 with step 0.0059 (0.1995) converged in 2 iterations. 0.221820 Δα.
77. 1.85 with step 0.0058 (0.1995) converged in 2 iterations. 0.242254 Δα.
78. 1.86 with step 0.0057 (0.1995) converged in 2 iterations. 0.286201 Δα.
79. 1.86 with step 0.0057 (0.1995) converged in 2 iterations. 0.388975 Δα.
80. 1.87 with step 0.0056 (0.1995) converged in 2 iterations. 0.681381 Δα.
81. 1.87 with step 0.0056 (0.1995) converged in 2 iterations. 2.454400 Δα.
82. 1.88 with step 0.0055 (0.1995) converged in 2 iterations. 1.787582 Δα.
83. 1.88 with step 0.0055 (0.1995) converged in 2 iterations. 0.820345 Δα.
84. 1.89 with step 0.0054 (0.1995) converged in 2 iterations. 0.627682 Δα.
85. 1.89 with step 0.0053 (0.1995) converged in 2 iterations. 0.642137 Δα.
86. 1.90 with step 0.0052 (0.1995) converged in 2 iterations. 0.975314 Δα.
87. 1.90 with step 0.0050 (0.1995) converged in 2 iterations. 5.470429 Δα.
88. 1.91 with step 0.0049 (0.1995) converged in 2 iterations. 1.196074 Δα.
89. 1.91 with step 0.0047 (0.1995) converged in 2 iterations. 0.837932 Δα.
90. 1.92 with step 0.0045 (0.1995) converged in 2 iterations. 1.499003 Δα.
91. 1.92 with step 0.0043 (0.1995) converged in 2 iterations. 2.760232 Δα.
92. 1.93 with step 0.0042 (0.1995) converged in 2 iterations. 0.740129 Δα.
93. 1.93 with step 0.0040 (0.1995) converged in 2 iterations. 0.434495 Δα.
94. 1.93 with step 0.0039 (0.1995) converged in 2 iterations. 0.320151 Δα.
95. 1.94 with step 0.0039 (0.1995) converged in 2 iterations. 0.271459 Δα.
96. 1.94 with step 0.0040 (0.1995) converged in 2 iterations. 0.285042 Δα.
97. 1.95 with step 0.0039 (0.1995) converged in 2 iterations. 0.274644 Δα.
98. 1.95 with step 0.0038 (0.1995) converged in 2 iterations. 0.309235 Δα.
99. 1.95 with step 0.0037 (0.1995) converged in 2 iterations. 0.416269 Δα.
100. 1.96 with step 0.0037 (0.1995) converged in 2 iterations. 0.728483 Δα.
101. 1.96 with step 0.0036 (0.1995) converged in 2 iterations. 3.111508 Δα.
102. 1.96 with step 0.0036 (0.1995) converged in 2 iterations. 1.314489 Δα.
103. 1.97 with step 0.0035 (0.1995) converged in 2 iterations. 0.545458 Δα.
104. 1.97 with step 0.0035 (0.1995) converged in 2 iterations. 0.366450 Δα.
105. 1.97 with step 0.0035 (0.1995) converged in 2 iterations. 0.287907 Δα.
106. 1.98 with step 0.0034 (0.1995) converged in 2 iterations. 0.249439 Δα.
107. 1.98 with step 0.0032 (0.1995) converged in 2 iterations. 0.234379 Δα.
108. 1.98 with step 0.0030 (0.1995) converged in 2 iterations. 0.231181 Δα.
109. 1.99 with step 0.0027 (0.1995) converged in 2 iterations. 0.239686 Δα.
110. 1.99 with step 0.0024 (0.1995) converged in 1 iterations. 0.266188 Δα.
111. 1.99 with step 0.0021 (0.1995) converged in 1 iterations. 0.301639 Δα.
112. 1.99 with step 0.0018 (0.1995) converged in 1 iterations. 0.304759 Δα.
113. 1.99 with step 0.0014 (0.1995) converged in 1 iterations. 0.315679 Δα.
114. 2.00 with step 0.0011 (0.1995) converged in 1 iterations. 0.333014 Δα.
115. 2.00 with step 0.0009 (0.1995) converged in 1 iterations. 0.359903 Δα.
116. 2.00 with step 0.0007 (0.1995) converged in 1 iterations. 0.406997 Δα.
117. 2.00 with step 0.0005 (0.1995) converged in 1 iterations. 0.505340 Δα.
118. 2.00 with step 0.0004 (0.1995) converged in 1 iterations. 0.781943 Δα.
119. 2.00 with step 0.0003 (0.1995) converged in 1 iterations. 3.030760 Δα.
120. 2.00 with step 0.0002 (0.1995) converged in 1 iterations. 0.990857 Δα.
121. 2.00 with step 0.0002 (0.1995) converged in 1 iterations. 0.381155 Δα.
122. 2.00 with step 0.0001 (0.1995) converged in 1 iterations. 0.290401 Δα.
123. 2.00 with step 0.0001 (0.1995) converged in 1 iterations. 0.246744 Δα.
124. 2.00 with step 0.0001 (0.1995) converged in 1 iterations. 0.225605 Δα.
125. 2.00 with step 0.0001 (0.1995) converged in 1 iterations. 0.219920 Δα.
126. 2.00 with step 0.0001 (0.1995) converged in 1 iterations. 0.228083 Δα.
127. 2.00 with step 0.0001 (0.1995) converged in 1 iterations. 0.115173 Δα.
128. 2.00 with step 0.0001 (0.1995) converged in 1 iterations. 0.103328 Δα.
129. 2.00 with step 0.0001 (0.1995) converged in 1 iterations. 0.093702 Δα.
130. 2.00 with step 0.0002 (0.1995) converged in 1 iterations. 0.088158 Δα.
131. 2.00 with step 0.0002 (0.1995) converged in 1 iterations. 0.089744 Δα.
132. 2.00 with step 0.0002 (0.1995) converged in 1 iterations. 0.094108 Δα.
133. 2.00 with step 0.0002 (0.1995) converged in 1 iterations. 0.099601 Δα.
134. 2.00 with step 0.0003 (0.1995) converged in 1 iterations. 0.105488 Δα.
135. 2.00 with step 0.0003 (0.1995) converged in 1 iterations. 0.348497 Δα.
136. 2.00 with step 0.0004 (0.1995) converged in 1 iterations. 0.295920 Δα.
137. 2.00 with step 0.0004 (0.1995) converged in 1 iterations. 0.264109 Δα.
138. 2.00 with step 0.0005 (0.1995) converged in 1 iterations. 0.243613 Δα.
139. 2.00 with step 0.0006 (0.1995) converged in 1 iterations. 0.229922 Δα.
140. 2.00 with step 0.0007 (0.1995) converged in 1 iterations. 0.220625 Δα.
141. 2.00 with step 0.0008 (0.1995) converged in 1 iterations. 0.214350 Δα.
142. 2.01 with step 0.0009 (0.1995) converged in 1 iterations. 0.210311 Δα.
143. 2.01 with step 0.0010 (0.1995) converged in 1 iterations. 0.208117 Δα.
144. 2.01 with step 0.0012 (0.1995) converged in 1 iterations. 0.207709 Δα.
145. 2.01 with step 0.0014 (0.1995) converged in 1 iterations. 0.209390 Δα.
146. 2.01 with step 0.0016 (0.1995) converged in 1 iterations. 0.213971 Δα.
147. 2.01 with step 0.0018 (0.1995) converged in 1 iterations. 0.223072 Δα.
148. 2.01 with step 0.0021 (0.1995) converged in 1 iterations. 0.198371 Δα.
149. 2.02 with step 0.0023 (0.1995) converged in 1 iterations. 0.199868 Δα.
150. 2.02 with step 0.0026 (0.1995) converged in 2 iterations. 0.191529 Δα.
151. 2.02 with step 0.0028 (0.1995) converged in 2 iterations. 0.196812 Δα.
152. 2.03 with step 0.0031 (0.1995) converged in 2 iterations. 0.210178 Δα.
153. 2.03 with step 0.0032 (0.1995) converged in 2 iterations. 0.234813 Δα.
154. 2.03 with step 0.0034 (0.1995) converged in 2 iterations. 0.284049 Δα.
155. 2.04 with step 0.0036 (0.1995) converged in 2 iterations. 0.382591 Δα.
156. 2.04 with step 0.0037 (0.1995) converged in 2 iterations. 0.606877 Δα.
157. 2.04 with step 0.0038 (0.1995) converged in 2 iterations. 1.727718 Δα.
158. 2.05 with step 0.0039 (0.1995) converged in 2 iterations. 2.067876 Δα.
159. 2.05 with step 0.0040 (0.1995) converged in 2 iterations. 0.654866 Δα.
160. 2.06 with step 0.0042 (0.1995) converged in 2 iterations. 0.412831 Δα.
161. 2.06 with step 0.0044 (0.1995) converged in 2 iterations. 0.345742 Δα.
162. 2.06 with step 0.0046 (0.1995) converged in 2 iterations. 0.320786 Δα.
163. 2.07 with step 0.0046 (0.1995) converged in 2 iterations. 0.348208 Δα.
164. 2.07 with step 0.0045 (0.1995) converged in 2 iterations. 0.422714 Δα.
165. 2.08 with step 0.0047 (0.1995) converged in 2 iterations. 0.669361 Δα.
166. 2.08 with step 0.0049 (0.1995) converged in 2 iterations. 1.835568 Δα.
167. 2.09 with step 0.0052 (0.1995) converged in 2 iterations. 2.138457 Δα.
168. 2.10 with step 0.0055 (0.1995) converged in 2 iterations. 1.247979 Δα.
169. 2.10 with step 0.0059 (0.1995) converged in 2 iterations. 7.772562 Δα.
170. 2.11 with step 0.0062 (0.1995) converged in 2 iterations. 1.110527 Δα.
171. 2.11 with step 0.0066 (0.1995) converged in 2 iterations. 0.767836 Δα.
172. 2.12 with step 0.0068 (0.1995) converged in 2 iterations. 0.912689 Δα.
173. 2.13 with step 0.0071 (0.1995) converged in 2 iterations. 2.401354 Δα.
174. 2.14 with step 0.0073 (0.1995) converged in 2 iterations. 1.307809 Δα.
175. 2.15 with step 0.0075 (0.1995) converged in 2 iterations. 0.496914 Δα.
176. 2.16 with step 0.0077 (0.1995) converged in 2 iterations. 0.367516 Δα.
177. 2.16 with step 0.0079 (0.1995) converged in 2 iterations. 0.341439 Δα.
178. 2.17 with step 0.0080 (0.1995) converged in 2 iterations. 0.336001 Δα.
179. 2.18 with step 0.0081 (0.1995) converged in 2 iterations. 0.332391 Δα.
180. 2.19 with step 0.0081 (0.1995) converged in 2 iterations. 0.325925 Δα.
181. 2.20 with step 0.0079 (0.1995) converged in 2 iterations. 0.315478 Δα.
182. 2.21 with step 0.0077 (0.1995) converged in 2 iterations. 0.300891 Δα.
183. 2.22 with step 0.0073 (0.1995) converged in 2 iterations. 0.282309 Δα.
184. 2.23 with step 0.0069 (0.1995) converged in 2 iterations. 0.260066 Δα.
185. 2.23 with step 0.0062 (0.1995) converged in 2 iterations. 0.172080 Δα.
186. 2.24 with step 0.0056 (0.1995) converged in 2 iterations. 0.150280 Δα.
187. 2.24 with step 0.0053 (0.1995) converged in 2 iterations. 0.142934 Δα.
188. 2.25 with step 0.0061 (0.1995) converged in 2 iterations. 0.165280 Δα.
189. 2.26 with step 0.0072 (0.1995) converged in 2 iterations. 0.196795 Δα.
190. 2.27 with step 0.0088 (0.1995) converged in 2 iterations. 0.244494 Δα.
191. 2.28 with step 0.0113 (0.1995) converged in 2 iterations. 0.325458 Δα.
192. 2.30 with step 0.0156 (0.1995) converged in 2 iterations. 0.494307 Δα.
193. 2.34 with step 0.0256 (0.1995) converged in 2 iterations. 1.044248 Δα.
194. 2.43 with step 0.0605 (0.1995) converged in 4 iterations. 3.552542 Δα.
195. 2.51 with step 0.0758 (0.1995) converged in 3 iterations. 0.854456 Δα.
196. 2.60 with step 0.0793 (0.1995) converged in 2 iterations. 0.344192 Δα.
197. 2.71 with step 0.0920 (0.1995) converged in 2 iterations. 0.404419 Δα.
198. 2.84 with step 0.1119 (0.1995) converged in 2 iterations. 0.467499 Δα.
199. 3.01 with step 0.1389 (0.1995) converged in 2 iterations. 0.521526 Δα.
200. 3.22 with step 0.1727 (0.1995) converged in 2 iterations. 0.560627 Δα.
201. 3.47 with step 0.2119 (0.1995) converged in 2 iterations. 0.581257 Δα.</code></pre><p>Obtain Harmonics</p><pre><code class="language-julia hljs">uh = zeros(Complex, maximum(h)+1, length(sols));
uh[[inds0; hinds], :] = hcat([[up[zinds];up[rinds,:]+1im*up[iinds,:]] for up in sols.up]...);
Oms = sols.p;</code></pre><h3 id="Stability-Analysis"><a class="docs-heading-anchor" href="#Stability-Analysis">Stability Analysis</a><a id="Stability-Analysis-1"></a><a class="docs-heading-anchor-permalink" href="#Stability-Analysis" title="Permalink"></a></h3><pre><code class="language-julia hljs">E0, _ = HARMONICSTIFFNESS(0., -2mdl.M, 0, 1, h);
E0 = collect(E0);
stab = zeros(length(Oms));
for (i,(J,Om)) in enumerate(zip(sols.J, Oms))
    evs = eigvals(J[2:3,2:3], Om*E0[2:3,2:3]);
    stab[i] = sum(real(evs).&gt;=0);
end</code></pre><h2 id="Bifurcation-Analysis"><a class="docs-heading-anchor" href="#Bifurcation-Analysis">Bifurcation Analysis</a><a id="Bifurcation-Analysis-1"></a><a class="docs-heading-anchor-permalink" href="#Bifurcation-Analysis" title="Permalink"></a></h2><h3 id="Setup-QPHB-for-Branch-Switching"><a class="docs-heading-anchor" href="#Setup-QPHB-for-Branch-Switching">Setup QPHB for Branch Switching</a><a id="Setup-QPHB-for-Branch-Switching-1"></a><a class="docs-heading-anchor-permalink" href="#Setup-QPHB-for-Branch-Switching" title="Permalink"></a></h3><pre><code class="language-julia hljs">Nhmax = 3;
hq = HSEL(Nhmax, [1.,1.]);

inds0q,hindsq, zindsq,rindsq,iindsq = HINDS(1, hq);
Nhcq = NHC(hq);
Nq = 32;

h01 = findall(vec(all(hq.==0, dims=2)));
hq1s = setdiff(findall(hq[:,2].==0), h01).-length(h01);  # w1 alone
hq2s = setdiff(findall(hq[:,1].==0), h01).-length(h01);  # w2 alone

Flq = zeros(Nhcq);
Flq[rindsq[hq2s[1]]] = pars.F;</code></pre><h3 id="Detection"><a class="docs-heading-anchor" href="#Detection">Detection</a><a id="Detection-1"></a><a class="docs-heading-anchor-permalink" href="#Detection" title="Permalink"></a></h3><pre><code class="language-julia hljs">bifis = findall(stab[1:end-1].!=stab[2:end]);
bifis[2] += 1;
dxis = [-1, 1];

bi = 2;
bifi = bifis[bi];
eVals, eVecs = eigen(sols.J[bifi][2:3, 2:3], Oms[bifi]*collect(E0[2:3,2:3]));
eVecsC = eVecs[1,:]-1im.*eVecs[2,:];  # Complexify

ei = argmax(abs.(eVecsC));  # Only one should &quot;survive&quot; for the Hopf bifurcation

sig = imag(eVals[ei]);
Wself = Oms[bifi] + sig;  # Self Excited Frequency
Pvec = normalize([real(eVecsC[ei]), -imag(eVecsC[ei])]);  # Perturbation Vector</code></pre><p>Setup Initial Guess</p><pre><code class="language-julia hljs">Uhq0 = zeros(Nhcq);
Uhq0[[rindsq[hq2s]; iindsq[hq2s]]] = sols.up[bifi][[rinds[1:length(hq2s)];
                                                    iinds[1:length(hq2s)]]];</code></pre><h3 id="Fit-the-HB-Residue-to-a-Local-Normal-form"><a class="docs-heading-anchor" href="#Fit-the-HB-Residue-to-a-Local-Normal-form">Fit the HB Residue to a Local Normal form</a><a id="Fit-the-HB-Residue-to-a-Local-Normal-form-1"></a><a class="docs-heading-anchor-permalink" href="#Fit-the-HB-Residue-to-a-Local-Normal-form" title="Permalink"></a></h3><pre><code class="language-julia hljs">Fl1 = Fl[[rinds[1], iinds[1]]];  # Single harmonic excitation
uh1 = sols.up[bifi][[rinds[1], iinds[1]]];  # Bifurcated Solution
vh1 = [normalize(real(eVecs[:,ei])) normalize(imag(eVecs[:,ei]))];  # Projector

uh0 = sols.up[bifi-dxis[bi]][[rinds[1], iinds[1]]];  # Previous Solution
d_amp = norm(vh1&#39;*(uh1-uh0));

E0f, _ = HARMONICSTIFFNESS(0, -2mdl.M, 0, Oms[bifi], 1)
xyfun = (u) -&gt; vh1\ (E0f\HBRESFUN!([uh1+vh1*u; Oms[bifi]], mdl, Fl1, 1, N));

A, B, C, H = NORMALFORMFIT(xyfun, d_amp/10, 100);
λ = sum(diag(A))/2;
α = sum(C[[1,4,5,8]])/4;

pVal, pVec = eigen(A);
vi = argmax(abs.(pVec[1,:]+1im*pVec[2,:]));
Pvec = vh1*pVec[:,vi];
Pvec = normalize([real(pVec[1]+1im*pVec[2]), imag(pVec[1]+1im*pVec[2])]);</code></pre><p>Perturbation Vector</p><pre><code class="language-julia hljs">Phq0 = zeros(Nhcq);
Phq0[[rindsq[hq1s[1]]; iindsq[hq1s[1]]]] = Pvec;</code></pre><p>Perturbation Amplitude</p><pre><code class="language-julia hljs">qamp = √(-λ/α);</code></pre><h3 id="Apply-phase-constraint-and-converge-with-deflation"><a class="docs-heading-anchor" href="#Apply-phase-constraint-and-converge-with-deflation">Apply phase constraint and converge with deflation</a><a id="Apply-phase-constraint-and-converge-with-deflation-1"></a><a class="docs-heading-anchor-permalink" href="#Apply-phase-constraint-and-converge-with-deflation" title="Permalink"></a></h3><pre><code class="language-julia hljs">cL = I(Nhcq+2)[:, setdiff(1:Nhcq+2, iindsq[hq1s[1]])];
uC = cL&#39;*[Uhq0; Wself; Oms[bifi]];

funq = NonlinearFunction((r,u,p)-&gt; QPHBRESFUN!([u;p], mdl, Flq, hq, Nq; R=r,cL=cL,U0=uC),
    jac=(J,u,p)-&gt;QPHBRESFUN!([u;p], mdl, Flq, hq, Nq; dRdU=J,cL=cL,U0=uC),
    paramjac=(Jp,u,p)-&gt;QPHBRESFUN!([u;p], mdl, Flq, hq, Nq; dRdw=Jp,cL=cL,U0=uC));

u0 = cL&#39;*[Uhq0+qamp*Phq0; Wself; Oms[bifi]];
probq = NonlinearProblem(funq, u0[1:end-1], u0[end]);
solq = solve(probq, show_trace=Val(true));</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">
Algorithm: NewtonRaphson(
    descent = NewtonDescent(),
    autodiff = AutoForwardDiff(),
    vjp_autodiff = AutoFiniteDiff(
        fdtype = Val{:forward}(),
        fdjtype = Val{:forward}(),
        fdhtype = Val{:hcentral}(),
        dir = true
    ),
    jvp_autodiff = AutoForwardDiff(),
    concrete_jac = Val{false}()
)

----    	-------------       	-----------
Iter    	f(u) inf-norm       	Step 2-norm
----    	-------------       	-----------
0       	3.09139649e-01      	1.20099539e+01
1       	3.80034629e-03      	3.84229560e-02
2       	1.14315920e-05      	8.27424479e-04
3       	2.93461256e-11      	2.03765315e-06
4       	1.39248960e-15      	8.59939019e-12
Final   	1.39248960e-15
----------------------</code></pre><p>We can now verify that the converged solution does indeed have an amplitude that&#39;s almost exactly equal to the normal form prediction.</p><pre><code class="language-julia hljs">[cL[2,:]&#39;*[solq.u; Oms[bifi]], qamp]</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">2-element Vector{Float64}:
 0.492270162003128
 0.49215865732462655</code></pre><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../d2_forcedvdp/">« 2: Bifurcation Analysis of the Forced Response of a Van der Pol Oscillator</a><a class="docs-footer-nextpage" href="../e_febeam/">E: Finite Element Beam with Nonlinear Support »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Saturday 10 January 2026 11:13">Saturday 10 January 2026</span>. Using Julia version 1.12.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
